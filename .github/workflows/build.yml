name: build

on:
  push:
  
jobs:
  buildForAllSupportedPlatforms:
    name: Build for ${{ matrix.targetPlatform }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        targetPlatform:
          - StandaloneWindows64 # Build a Windows 64-bit standalone.
          - Android # Build an Android .apk standalone app.
          - WebGL # WebGL.
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
          lfs: true
      - uses: actions/cache@v2
        with:
          path: Library
          key: Library-${{ matrix.targetPlatform }}
          restore-keys: Library-
      - name: Install Unity
        run: |
          curl -sSL https://game.ci/api/installer | bash -s -- --yes --branch ${{ env.UNITY_VERSION }} --install-location /opt/unity
      - name: Build and Test
        env:
          UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
          UNITY_PROJECT_PATH: "URP_ShortCI" # Update this to match your Unity project path
          UNITY_VERSION: "2020.3.25f1" # Update this to match the Unity version you want to use
          TARGET_PLATFORM: ${{ matrix.targetPlatform }}
        run: |
          export UNITY_LICENSE="$UNITY_LICENSE"
          export UNITY_PROJECT_PATH="$UNITY_PROJECT_PATH"
          export UNITY_VERSION="$UNITY_VERSION"
          export TARGET_PLATFORM="$TARGET_PLATFORM"
          curl -sSL https://game.ci/api/runner | bash -s -- --project-path "$UNITY_PROJECT_PATH" --unity-version "$UNITY_VERSION" --target-platform "$TARGET_PLATFORM" --execute build
      - uses: actions/upload-artifact@v2
        with:
          name: Build-${{ matrix.targetPlatform }}
          path: build/${{ matrix.targetPlatform }}
